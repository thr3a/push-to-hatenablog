---
Title: バンドリを支えるインフラ構成
Category:
- memo
Date: 2018-03-10T12:44:32+09:00
URL: https://blog.turai.work/entry/20180310/1520653472
EditURL: https://blog.hatena.ne.jp/thr3a/thr3a.hatenablog.com/atom/entry/17391345971623954390
---

結構前になってしまうが、株式会社サムザップ主催のインフラ勉強会に参加した。

[https://sumzaptechnight.connpass.com/event/75982/:embed:cite]

そこで某神ゲーバンドリの生みの親こと、[株式会社Craft Egg](https://www.craftegg.co.jp/)のインフラ担当者が発表していたのでメモ。

# 発表者 is 誰

山村英貴氏。親会社のサイバーエージェントからの移動？的な

> 株式会社Craft Egg 山村英貴(yamamura hideki)  
> 京都大学工学部卒業。2013年サイバーエージェント新卒入社。 
>  サーバーサイドエンジニアとして画像配信、広告配信、リアルタイム通信基盤、チャット基盤、アセットバンドル配信基盤などを担当、現在は「バンドリ！ ガールズバンドパーティ！」でサーバーとインフラを担当。

# サーバー構成

インフラは主にAWSで運用してる

- ユーザーDBは16台構成
  - r3 2xlarge r3 8xlarge 16台
  - ユーザーIDの剰余でDBを分割
- 現在over 8000 req/s

リリース前はDB１台で捌く予定だったらしく（やばすぎ）、負荷試験かけると1200req/sで一瞬でCPUが100%になる症状が発生していた

そこで、ユーザーに紐付かない情報は共通DBに残しつつ、ユーザーに紐づくデータは分割することで負荷を分散させた

# その他のよもやま話

- Aurora MySQLの互換性は問題なし
- Aurora MySQLはレイテンシが安定している　読み書き両方
- ただしテーブルスキャン速度は普通（テーブルを全文舐めるようなクエリは普通の速度
- スナップショット機能、データ巻き戻し機能はとても便利

# 他に使ったサービス

- Athena ログ解析に使用
- CloudFront
- Route53
- S3
- Kinesis Firehose


ここまで話してくださって本当にありがとうございました。
